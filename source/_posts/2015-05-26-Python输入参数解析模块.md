---
title: Python输入参数解析模块
date: 2015-05-26 20:57:55
tags: Python
categories: Linux
---

> argparse — Parser for command-line options, arguments and sub-commands

先举个例子：
实现读、写寄存器两个功能，`-r`表示读，`-w`表示写。
```
usage: mdw.py [-h] [-r ADDR [NUM ...]] [-w ADDR [VALUES ...]]

Read or Write ARM Memory.

optional arguments:
  -h, --help            show this help message and exit
  -r ADDR [NUM ...]     read NUM words from ADDR
  -w ADDR [VALUES ...]  write VALUES to ADDR
```

实现如下：
```
def main():
    parser = argparse.ArgumentParser(decription='Read or Write ARM Memory.')

    parser.add_argument('-r', dest='read', nargs='+',
            type=(lambda x: int(x,0)), metavar=('ADDR', 'NUM'),
            help='read NUM words from ADDR');

    parser.add_argument('-w', dest='write', nargs='+',
            type=(lambda x: int(x,0)), metavar=('ADDR', 'VALUES'),
            help='write VALUES to ADDR');

    args = parser.parse_args()

    if args.write is not None and args.read is not None:
        parser.print_help()
        return -1
    elif args.write is None and args.read is None:
        parser.print_help()
        return -1
    elif args.write is not None and len(args.write) == 1:
        parser.print_help()
        print 'write at least one value'
        return -1
    elif args.write is not None:
        ADDR = args.write[0]
        VALUES = args.write[1:]
        return mw(ADDR, VALUES);
    else args.read is not None:
        ADDR = args.read[0]
        if len(args.read) == 1 :
            print '%08X: %08X' % (ADDR, md(ADDR)[0])
        else:
            NUM = args.read[1]
            for val in md(ADDR, NUM) :
                print '%08X: %08X' % (ADDR, val)
                ADDR += 4
        return 0

if __name__ == '__main__':
    sys.exit(main())
```


关键部分
```
parser.add_argument('-r', dest='read', nargs='+',
            type=(lambda x: int(x,0)), metavar=('ADDR', 'NUM'),
            help='read NUM words from ADDR');
```

其中:
`-r`: 代表参数名
`dest='read'`: 参数解析后的名称
`nargs='+'`: 表示`-r`至少还需要一个参数
`type=(lambda x: int(x,0))`: 表示可输入的参数是10进制或16进制整型
`metavar=('ADDR', 'NUM')`: 在打印help信息时参数名