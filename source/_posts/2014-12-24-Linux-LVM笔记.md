---
title: Linux LVM笔记
date: 2014-12-24 21:06:43
tags:
- LVM
categories:
- Linux
---

> Happy Christmas Eve

#1 LVM介绍
逻辑卷管理LVM是一个多才多艺的硬盘系统工具。无论在Linux或者其他类似的系统，都是非常的好用。传统分区使用固定大小分区，重新调整大小十分麻烦。但是，LVM可以创建和管理“逻辑”卷，而不是直接使用物理硬盘。可以让管理员弹性的管理逻辑卷的扩大缩小，操作简单，而不损坏已存储的数据。可以随意将新的硬盘添加到LVM，以直接扩展已经存在的逻辑卷。LVM并不需要重启就可以让内核知道分区的存在。

LVM使用分层结构，如下图所示。

![](https://dn-ljgabc.qbox.me/image/0/6e/4762cd2620f3c59b4ba48c11b7336.jpg)

从上到下依次为：

1. 物理硬盘分区
2. 建立在物理硬盘分区之上的物理卷(PV)
3. 由一个或多个物理卷(PV)组成的一个卷组(VG)
4. 基于卷组(VG)创建的逻辑卷(LV)

逻辑卷(LV)就是我们最终使用的`分区`，挂载到`/`、`/home`等。

图中关键部分是逻辑卷(LV)不再依赖于实际的物理硬盘分区，而是依赖于抽象出的卷组(VG)。而卷组是可以跨分区甚至跨硬盘的。

在系统运行过程中，当一个分区`/`空间不足时(本质是对应的逻辑卷LV空间不足)：
    
* 如果该LV对应的VG上有空间时，直接分配即可。
* 如果VG上已没有剩余空间,
    * 可以先缩小该VG上的其他LV，再增大`/`对应的LV;
    * 或者在一块新硬盘上创建一个PV，加入到VG中，之后再扩大LV的大小。


#2 LVM命令

#2.0 硬盘分区

硬盘分区跟一般情况下的分区没有什么不同，只不过在选择分区类型时要指定为`8e`，即LVM对应的分区编码。

#2.1 物理卷(PV)
物理卷是建立在硬盘分区之上的。与物理卷相关的命令有：

1. pvcreate
创建一个物理卷，如 `pvcreate /dev/sda1`
2. pvremove
删除一个物理卷，如 `pvremove /dev/sda1`
3. pvdisplay
查看物理卷情况。
4. pvresize
重新分配物理卷的大小。
5. pvmove
移动物理卷，如 `pvmode /dev/sda1 /dev/sda2`
6. pvchange
更改物理卷的属性，如`pv change -x n /dev/sda1`(不能再分配)
7. pvs
打印物理卷信息，与pvdisplay类似。
8. pvck
检查物理卷的metadata属性。
9. pvscan
扫描所有硬盘上的物理卷。

#2.2 卷组(VG)
卷组是一个或多个物理卷的集合，作为一块儿抽象的硬盘向上提供存储服务。与卷组相关的命令有：

1. vgcreate
创建一个卷组，如 `vgcreate vg_name /dev/sda1 /dev/sda2`,使用两个PV创建一个VG
2. vgremove
删除一个卷组，如 `vgremove vg_name`
3. vgdisplay
显示卷组信息。
4. vgextend
向卷组中添加物理卷，如 `vgextend vg_name /dev/sdb1`
5. vgreduce
从卷组中删除物理卷，如 `vgreduce vg_name /dev/sdb1`
6. vgmerge
合并两个卷组,如 `vgnerge vg_name my_vg`，将my_vg合并到vg_name
7. vgsplit
拆分卷组。
8. vgrename
卷组重命名。
9. vgchange
更改卷组属性。
10. vgck
检查卷组属性。
11. vgs
显示卷组信息。
12. vgscan
扫描硬盘上所有的卷组。
13. vgcfgbackup
备份卷组描述信息。
14. vgcfgrestore
回复卷组描述信息。
15. vgconvert
转换卷组信息格式，如 `vgconvert -M2 vg1`，从LVM1信息格式转换到LVM2.
16. vgexport
使卷组对系统不可见，便于做其他修改。
17. vgimport
重新使卷组对系统可见。
18. vgimportclone
不知。
19. vgmknodes
不知。

#2.3 逻辑卷(LV)
逻辑卷是最终提供给用户使用的"分区"。与逻辑卷相关的命令有：

1. lvcreate
创建逻辑卷，如 `lvcreate -n lv_name -L 10G vg_name`
2. lvremove
删除逻辑卷，如 `lvremove vg_name/lv_name`
3. lvdisplay
显示逻辑卷信息。
4. lvextend
扩展逻辑卷大小，如 `lvextend -L +5G vg_name/lv_name /dev/sdb1`
5. lvresize
更改逻辑卷大小，如 `lvresize -L 15G vg_name`
6. lvrename
逻辑卷重命名。
7. lvchange
修改逻辑卷属性。
8. lvconvert
转换逻辑卷类型(linear -> mirror or snapshort)
9. lvreduce
缩小逻辑卷大小。
10. lvs
显示逻辑卷信息。
11. lvscan
扫描硬盘上所有的逻辑卷。