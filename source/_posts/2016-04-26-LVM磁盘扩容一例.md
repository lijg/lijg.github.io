---
title: LVM磁盘扩容一例
date: 2016-04-26 15:03:24
tags:
- LVM
categories:
- Linux
---

先前用VirtualBox给Debian只分配了20G的硬盘容量，今天编译QT的时候磁盘容量不足，需要将根分区扩容。

# 1 准备磁盘

首先，用VboxManager给修改磁盘容量
```
# 修改磁盘容量上限为100G
D:\VirtualBox\VBoxManage.exe modifyhd "E:\VirtualMachines\Debian\Debian.vdi" --resize 102400
```

启动Debian虚拟机，使用cfdisk工具，可以看到磁盘容量已经由20G变为100G，多出来的容量成为自由空间（未分配）
```
cfdisk /dev/sda
```

在自由空间上新建分区，保存。此时的磁盘分区情况如下：
```
/dev/sda1   100M  /boot分区
/dev/sda2   20G   分给debianvbox-vg
/dev/sda3   80G   
```

# 2 扩容

首先查看一下现有的PV
```
# pvdisplay

--- Physical volume ---
 PV Name    /dev/sda2
 VG Name    debianvbox-vg
 PV Size    19.8Gib
 ....
```

查看VG
```
# vgdisplay
--- Volume group ---
 VG Name    debianvbox-vg
 ...
 VG Size    19.8Gib
 ...
```

将/dev/sd3加入VG
```
vgextend debianvbox-vg /dev/sda3
```

确认PV和VG
```
# pvdisplay
--- Physical volume ---
 PV Name    /dev/sda2
 VG Name    debianvbox-vg
 PV Size    19.8Gib
 ....

--- Physical volume ---
 PV Name    /dev/sda3
 VG Name    debianvbox-vg
 PV Size    80Gib
 ....
```

查看LV
```
# lvdisplay
--- Ligical volume ---
 LV PATH    /dev/debianvbox-vg/root
 LV Name    root
 VG Name    debianvbox-vg
 ...
 LV Size    19.8G
 ...

--- Ligical volume ---
 LV PATH    /dev/debianvbox-vg/swap
 LV Name    swap
 VG Name    debianvbox-vg
 ...
 LV Size    1.0G
 ...
```

扩容
```
lvresize -L 80G /dev/debianvbox-vg/root
```

修改磁盘容量大小
```
resize2fs /dev/debianvobx-vg/root
```

完。