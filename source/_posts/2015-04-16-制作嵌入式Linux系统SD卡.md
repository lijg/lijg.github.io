---
title: 制作嵌入式Linux系统SD卡
date: 2015-04-16 21:21:03
tags: 
- 嵌入式
categories: 
- Linux
---

#1 SD卡分区
SD卡要大于等于2GB，只需添加一个ext4分区，第一个分区之前要预留至少20MB给kernel和dtb

![分区](/images/2016-02-17/18-17-16.jpg)


#2 烧录镜像

需要烧录uboot、kernel和dtb三个镜像到SD卡的预留空间中

```
# 烧录uboot，从第2个block开始(imx会从sd卡上第2个block开始读取uboot)
dd if=uboot.imx of=/dev/sdb bs=512 seek=2;sync

# 烧录uImage，从2048个block开始，中间预留了 (2048-2) * 512 约 1MB空间给uboot
dd if=uImage of=/dev/sdb bs=512 seek=2048;sync

# 烧录dtb，中间预留了(20480-2048) * 512 越 9MB空间给uImage
dd if=imx6q.dtb of=/dev/sdb bs=512 seek=20480;sync
```

#3 文件系统
接下来需要将文件系统拷贝到SD卡上的ext4(ext2、ext3等等均可)分区

```
mkfs.ext4 /dev/sdb1
mount /dev/sdb1 /mnt
cp -a linux_rootfs/* /mnt && sync
umount /dev/sdb1
```

#4 启动参数

```
# uImage拷贝到内存中的位置
setenv loadaddr 0x12000000

# dtb拷贝到内存中的位置
setenv dtbloadaddr 0x18000000

# uImage位置 2048 = 0x800， 拷贝10MB的空间
setenv kernel_addr 0x800
setenv kernel_len 0x5000

# dtb 位置 20480 = 0x5000， 拷贝256B空间
setenv dtb_addr 0x5000
setenv dtb_len 0x100

# 先从sd卡上指定位置读出uImage和dtb，然后 bootm uImage_addr - dtb_addr
setenv bootcmd 'mmc dev 0;mmc read ${loadaddr} ${kernel_addr} ${kernel_len};mmc read ${dtbloadaddr} ${dtb_addr} ${dtb_len};bootm ${loadaddr} - ${dtbloadaddr}'

# 设置串口及文件系统位置
setenv bootargs 'console=ttymxc0,115200 init=/init rw root=/dev/mmcblk1p1'
```