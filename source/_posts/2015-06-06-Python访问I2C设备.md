---
title: Python访问I2C设备
date: 2015-06-06 11:04:51
tags: 
- Python 
- I2C
categories: 
- Linux
---

Python访问I2C设备需要用到smbus扩展，附件是已经编译好的适用于ARM EABI的扩展，直接跟脚本放在相同的目录即可使用。

Python访问I2C设备本质上还是通过/dev/i2c-*节点来操作I2C设备的，所以，在操作之前，必须在/dev/i2c-*节点。

* 使用
```
#!/usr/bin/python
# -*- coding: utf-8 -*-

import smbus

bus = smbus.SMBus(0)  # 0 对应/dev/i2c-0，依此类推

# 读写24LC02 EEPROM方法
bus.write_byte_data(SLAVE_ADDR, addr, val)
bus.read_byte_data(SLAVE_ADDR, addr)

bus.close
```

* 常用方法
```
read_byte(SLAVE_ADDR)
write_byte(SLAVE_ADDR, val)
read_byte_data(SLAVE_ADDR, addr)
write_byte_data(SLAVE_ADDR, addr, val)
read_word_data(SLAVE_ADDR, addr)
write_word_data(SLAVE_ADDR, addr, val)
read_block_data(SLAVE_ADDR, addr)
write_block_data(SLAVE_ADDR, addr, [vals])
```

* Python读写EEPROM库
```
#!/usr/bin/python
# -*- coding: utf-8 -*-

'''access to eeprom 24lc02'''

import sys, argparse
import smbus

# /dev/i2c-1
EEPROM_SLOT = 1
EEPROM_ADDR = 0x51

def mw(addr, vals):
    bus = smbus.SMBus(EEPROM_SLOT)
    bus.write_byte_data(EEPROM_ADDR, addr, vals)
    bus.close()
    return 0

def md(addr):
    bus = smbus.SMBus(EEPROM_SLOT)
    ret = bus.read_byte_data(EEPROM_ADDR, addr)
    bus.close()
    return ret

def main():
    parser = argparse.ArgumentParser(description='Read or Write EEPROM.')

    parser.add_argument('-r', dest='read', 
            type=(lambda x: int(x,0)), metavar='ADDR',
            help='read one word from ADDR');

    parser.add_argument('-w', dest='write', nargs=2,
            type=(lambda x: int(x,0)), metavar=('ADDR', 'VALUE'),
            help='write VALUE to ADDR');

    args = parser.parse_args()

    if args.write is not None and args.read is not None:
        parser.print_help()
        return -1
    elif args.write is None and args.read is None:
        parser.print_help()
        return -1
    elif args.write is not None and len(args.write) == 1:
        parser.print_help()
        print 'write at least one value'
        return -1
    elif args.write is not None:
        ADDR = args.write[0]
        VALUES = args.write[1]
        return mw(ADDR, VALUES);
    else:
        ADDR = args.read
        print '%08X: %08X' % (ADDR, md(ADDR))
        return 0

if __name__ == '__main__':
    sys.exit(main())
```

* 附件
[smbus.so.tar][1]