---
title: Typecho折腾备忘
date: 2015-05-23 22:18:41
tags: 
- Typecho
- HHVM
categories: Linux
---

#1 安装Nginx + HHVM

环境:`ubuntu 14.04`

**安装Nginx**
```
sudo apt-get install nginx
```

**安装HHVM**

```
wget -O - sudo apt-key add
sudo add-apt-repository 'deb http://dl.hhvm.com/ubuntu trusty main'
sudo apt-get update
sudo apt-get install hhvm
sudo /usr/share/hhvm/install_fastcgi.sh
```

# 2 配置Nginx + HHVM

**Nginx**
```
sudo vim /etc/nginx/site-available/default
```
修改成类似这个样子
```
server {
    listen 80;

    root /var/www;
    index index.php index.html index.htm;

    include hhvm.conf;

    location / {
        if (-f $request_filename/index.html){
            rewrite (.*) $1/index.html break;
        }
        if (-f $request_filename/index.php){
            rewrite (.*) $1/index.php;
        }
        if (!-f $request_filename){
            rewrite (.*) /index.php;
        }
    }

    error_page 404 /404.html;

    # redirect server error pages to the static page /50x.html
    #
    error_page 500 502 503 504 /50x.html;
    location = /50x.html {
        root /usr/share/nginx/html;
    }
}
```
**HHVM**
```
sudo vim /etc/nginx/hhvm.conf
```
修改成类似这个样子
```
location ~ .*\.(hh|php)(\/.*)*$ {
    fastcgi_split_path_info ^(.+\.php)(/.+)$;
    fastcgi_keep_conn on;
    fastcgi_pass   127.0.0.1:9000;
    fastcgi_index  index.php;
    fastcgi_param  SCRIPT_FILENAME $document_root$fastcgi_script_name;
    include        fastcgi_params;
}
```

大功告成。


# 3 折腾

**修改归档显示方式**
打开sidebar.php，修改代码
```
<?php $this->widget('Widget_Contents_Post_Date', 'type=month&format=Y年m月')
            ->parse('<li><a href="{permalink}">{date}</a></li>'); ?>
```

